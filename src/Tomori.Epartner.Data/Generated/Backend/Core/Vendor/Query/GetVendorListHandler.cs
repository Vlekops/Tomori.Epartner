//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template.
//     Manual changes to this file will be overwritten if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using AutoMapper;
using MediatR;
using Vleko.DAL.Interface;
using Microsoft.EntityFrameworkCore;
using System.Linq.Expressions;
using Microsoft.Extensions.Logging;
using Tomori.Epartner.Data;
using Tomori.Epartner.Data.Model;
using Vleko.Result;
using Tomori.Epartner.Core.Response;
using Tomori.Epartner.Core.Helper;

namespace Tomori.Epartner.Core.Vendor.Query
{
    public class GetVendorListRequest : ListRequest,IListRequest<GetVendorListRequest>,IRequest<ListResponse<VendorResponse>>
    {
    }
    internal class GetVendorListHandler : IRequestHandler<GetVendorListRequest, ListResponse<VendorResponse>>
    {
        private readonly ILogger _logger;
        private readonly IMapper _mapper;
        private readonly IUnitOfWork<ApplicationDBContext> _context;
        public GetVendorListHandler(
            ILogger<GetVendorListHandler> logger,
            IMapper mapper,
            IUnitOfWork<ApplicationDBContext> context
            )
        {
            _logger = logger;
            _mapper = mapper;
            _context = context;
        }

        public async Task<ListResponse<VendorResponse>> Handle(GetVendorListRequest request, CancellationToken cancellationToken)
        {
            ListResponse<VendorResponse> result = new ListResponse<VendorResponse>();
            try
            {
				var query = _context.Entity<Tomori.Epartner.Data.Model.Vendor>().AsQueryable();

				#region Filter
				Expression<Func<Tomori.Epartner.Data.Model.Vendor, object>> column_sort = null;
				List<Expression<Func<Tomori.Epartner.Data.Model.Vendor, bool>>> where = new List<Expression<Func<Tomori.Epartner.Data.Model.Vendor, bool>>>();
				if (request.Filter != null && request.Filter.Count > 0)
				{
					foreach (var f in request.Filter)
					{
						var obj = ListExpression(f.Search, f.Field, true);
						if (obj.where != null)
							where.Add(obj.where);
					}
				}
				if (where != null && where.Count() > 0)
				{
					foreach (var w in where)
					{
						query = query.Where(w);
					}
				}
				if (request.Sort != null)
                {
					column_sort = ListExpression(request.Sort.Field, request.Sort.Field, false).order!;
					if(column_sort != null)
						query = request.Sort.Type == SortTypeEnum.ASC ? query.OrderBy(column_sort) : query.OrderByDescending(column_sort);
					else
						query = query.OrderBy(d=>d.Id);
				}
				#endregion

				var query_count = query;
				if (request.Start.HasValue && request.Length.HasValue && request.Length > 0)
					query = query.Skip((request.Start.Value - 1) * request.Length.Value).Take(request.Length.Value);
				var data_list = await query.ToListAsync();

				result.List = _mapper.Map<List<VendorResponse>>(data_list);
				result.Filtered = data_list.Count();
				result.Count = await query_count.CountAsync();
				result.OK();
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Failed Get List Vendor", request);
                result.Error("Failed Get List Vendor", ex.Message);
            }
            return result;
        }

        #region List Utility
		private (Expression<Func<Tomori.Epartner.Data.Model.Vendor, bool>> where, Expression<Func<Tomori.Epartner.Data.Model.Vendor, object>> order) ListExpression(string search, string field, bool is_where)
		{
			Expression<Func<Tomori.Epartner.Data.Model.Vendor, object>> result_order = null;
			Expression<Func<Tomori.Epartner.Data.Model.Vendor, bool>> result_where = null;
            if (!string.IsNullOrWhiteSpace(search) && !string.IsNullOrWhiteSpace(field))
            {
                field = field.Trim().ToLower();
                search = search.Trim().ToLower();
                switch (field)
                {
					case "id" : 
						if(is_where){
							if (Guid.TryParse(search, out var _Id))
								result_where = (d=>d.Id == _Id);
								else
								result_where = (d=>d.Id == Guid.Empty);
						}
						else
							result_order = (d => d.Id);
					break;
					case "activityname" : 
						if(is_where){
							result_where = (d=>d.ActivityName.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.ActivityName);
					break;
					case "address" : 
						if(is_where){
							result_where = (d=>d.Address.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Address);
					break;
					case "ahuonlinefile" : 
						if(is_where){
							result_where = (d=>d.AhuOnlineFile.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.AhuOnlineFile);
					break;
					case "aktanotarisfile" : 
						if(is_where){
							result_where = (d=>d.AktaNotarisFile.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.AktaNotarisFile);
					break;
					case "cityname" : 
						if(is_where){
							result_where = (d=>d.CityName.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.CityName);
					break;
					case "civdid" : 
						if(is_where){
							if (int.TryParse(search, out var _CivdId))
								result_where = (d=>d.CivdId == _CivdId);
						}
						else
							result_order = (d => d.CivdId);
					break;
					case "companytype" : 
						if(is_where){
							result_where = (d=>d.CompanyType.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.CompanyType);
					break;
					case "completeddate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _CompletedDate))
								result_where = (d=>d.CompletedDate == _CompletedDate);
						}
						else
							result_order = (d => d.CompletedDate);
					break;
					case "contactperson" : 
						if(is_where){
							result_where = (d=>d.ContactPerson.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.ContactPerson);
					break;
					case "createby" : 
						if(is_where){
							result_where = (d=>d.CreateBy.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.CreateBy);
					break;
					case "createdate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _CreateDate))
								result_where = (d=>d.CreateDate == _CreateDate);
						}
						else
							result_order = (d => d.CreateDate);
					break;
					case "docnpwp" : 
						if(is_where){
							result_where = (d=>d.DocNpwp.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.DocNpwp);
					break;
					case "expireddate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _ExpiredDate))
								result_where = (d=>d.ExpiredDate == _ExpiredDate);
						}
						else
							result_order = (d => d.ExpiredDate);
					break;
					case "faxnumber" : 
						if(is_where){
							result_where = (d=>d.FaxNumber.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.FaxNumber);
					break;
					case "filespdaid" : 
						if(is_where){
							result_where = (d=>d.FileSpdaId.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.FileSpdaId);
					break;
					case "filevendorid" : 
						if(is_where){
							result_where = (d=>d.FileVendorId.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.FileVendorId);
					break;
					case "isautogenerate" : 
						if(is_where){
							result_where = (d=>d.IsAutoGenerate.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.IsAutoGenerate);
					break;
					case "jabatan" : 
						if(is_where){
							result_where = (d=>d.Jabatan.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Jabatan);
					break;
					case "jenisusaha" : 
						if(is_where){
							result_where = (d=>d.JenisUsaha.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.JenisUsaha);
					break;
					case "k3sahuonlinefile" : 
						if(is_where){
							result_where = (d=>d.K3sAhuOnlineFile.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.K3sAhuOnlineFile);
					break;
					case "k3sname" : 
						if(is_where){
							result_where = (d=>d.K3sname.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.K3sname);
					break;
					case "k3snamespda" : 
						if(is_where){
							result_where = (d=>d.K3snameSpda.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.K3snameSpda);
					break;
					case "linkpid" : 
						if(is_where){
							result_where = (d=>d.LinkPid.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.LinkPid);
					break;
					case "npwp" : 
						if(is_where){
							result_where = (d=>d.Npwp.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Npwp);
					break;
					case "npwppusat" : 
						if(is_where){
							result_where = (d=>d.NpwpPusat.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.NpwpPusat);
					break;
					case "officestatus" : 
						if(is_where){
							result_where = (d=>d.OfficeStatus.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.OfficeStatus);
					break;
					case "pabrikan" : 
						if(is_where){
							result_where = (d=>d.Pabrikan.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Pabrikan);
					break;
					case "pemberisanksi" : 
						if(is_where){
							result_where = (d=>d.PemberiSanksi.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.PemberiSanksi);
					break;
					case "phonenumber" : 
						if(is_where){
							result_where = (d=>d.PhoneNumber.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.PhoneNumber);
					break;
					case "provincename" : 
						if(is_where){
							result_where = (d=>d.ProvinceName.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.ProvinceName);
					break;
					case "regid" : 
						if(is_where){
							if (int.TryParse(search, out var _RegId))
								result_where = (d=>d.RegId == _RegId);
						}
						else
							result_order = (d => d.RegId);
					break;
					case "sahamasing" : 
						if(is_where){
							result_where = (d=>d.SahamAsing.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.SahamAsing);
					break;
					case "sanksi" : 
						if(is_where){
							result_where = (d=>d.Sanksi.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Sanksi);
					break;
					case "situ" : 
						if(is_where){
							result_where = (d=>d.Situ.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Situ);
					break;
					case "situenddate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _SituEndDate))
								result_where = (d=>d.SituEndDate == _SituEndDate);
						}
						else
							result_order = (d => d.SituEndDate);
					break;
					case "situfile" : 
						if(is_where){
							result_where = (d=>d.SituFile.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.SituFile);
					break;
					case "situstartdate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _SituStartDate))
								result_where = (d=>d.SituStartDate == _SituStartDate);
						}
						else
							result_order = (d => d.SituStartDate);
					break;
					case "spdafile" : 
						if(is_where){
							result_where = (d=>d.SpdaFile.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.SpdaFile);
					break;
					case "spdaid" : 
						if(is_where){
							if (int.TryParse(search, out var _SpdaId))
								result_where = (d=>d.SpdaId == _SpdaId);
						}
						else
							result_order = (d => d.SpdaId);
					break;
					case "spdano" : 
						if(is_where){
							result_where = (d=>d.SpdaNo.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.SpdaNo);
					break;
					case "spdavalidity" : 
						if(is_where){
							result_where = (d=>d.SpdaValidity.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.SpdaValidity);
					break;
					case "statusperusahaan" : 
						if(is_where){
							result_where = (d=>d.StatusPerusahaan.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.StatusPerusahaan);
					break;
					case "updateby" : 
						if(is_where){
							result_where = (d=>d.UpdateBy.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.UpdateBy);
					break;
					case "updatedate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _UpdateDate))
								result_where = (d=>d.UpdateDate == _UpdateDate);
						}
						else
							result_order = (d => d.UpdateDate);
					break;
					case "uploaddate" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _UploadDate))
								result_where = (d=>d.UploadDate == _UploadDate);
						}
						else
							result_order = (d => d.UploadDate);
					break;
					case "uploaddateahuonline" : 
						if(is_where){
							if (DateTime.TryParse(search, out var _UploadDateAhuOnline))
								result_where = (d=>d.UploadDateAhuOnline == _UploadDateAhuOnline);
						}
						else
							result_order = (d => d.UploadDateAhuOnline);
					break;
					case "vendoremail1" : 
						if(is_where){
							result_where = (d=>d.VendorEmail1.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.VendorEmail1);
					break;
					case "vendoremail2" : 
						if(is_where){
							result_where = (d=>d.VendorEmail2.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.VendorEmail2);
					break;
					case "vendorid" : 
						if(is_where){
							if (int.TryParse(search, out var _VendorId))
								result_where = (d=>d.VendorId == _VendorId);
						}
						else
							result_order = (d => d.VendorId);
					break;
					case "vendorname" : 
						if(is_where){
							result_where = (d=>d.VendorName.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.VendorName);
					break;
					case "vendorstatus" : 
						if(is_where){
							result_where = (d=>d.VendorStatus.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.VendorStatus);
					break;
					case "website" : 
						if(is_where){
							result_where = (d=>d.Website.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.Website);
					break;
					case "zipcode" : 
						if(is_where){
							result_where = (d=>d.ZipCode.Trim().ToLower().Contains(search));
						}
						else
							result_order = (d => d.ZipCode);
					break;

                }
            }
            return (result_where, result_order);
        }
        #endregion
    }
}

